<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="css/styles.css">
    <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</title>
</head>
<body onload="window.scrollTo(0, 0);">

    <div class="container">
        <h1>üá∫üá∏ –¢—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</h1>
        <p>–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞</p>

        <div class="word-container" id="word">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

        <div class="options" id="options">
            <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JS -->
        </div>

        <div class="score" id="score">–°—á—ë—Ç: 0 / 0</div>
        <div class="result" id="result"></div>

        <button id="nextBtn" disabled>–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
        <button class="export-btn" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ TXT</button>
    </div>

    <div class="footer">–°–¥–µ–ª–∞–Ω–æ –¥–ª—è –í–∞—Å by Hexxeh777-svg. –ë–µ–∑ —Ä–µ–∫–ª–∞–º—ã. –ë–µ–∑ –≤–∏–¥–µ–æ. –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –∏ –¥—É—à–∞.</div>

    <script>
        let words = [];
        let currentWord = null;
        let score = 0;
        let total = 0;
        let usedWords = [];

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è –∏–∑ —Ñ–∞–π–ª–∞
        async function loadWords() {
            try {
                const response = await fetch('dictionary/dictionary.js');
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status}`);
                words = await response.json();
                showWord();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è:', error);
                document.getElementById("word").textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è";
            }
        }

        function getRandomWord() {
            if (words.length === 0) return null;
            let available = words.filter(w => !usedWords.includes(w.en));
            if (available.length === 0) usedWords = [];
            const word = available[Math.floor(Math.random() * available.length)];
            usedWords.push(word.en);
            return word;
        }

        function generateOptions(correctAnswer) {
            if (words.length < 4) return [correctAnswer];
            
            const options = [correctAnswer];
            const wrongOptions = words
                .filter(w => w.ru !== correctAnswer)
                .map(w => w.ru);
            
            for (let i = 0; i < 3 && i < wrongOptions.length; i++) {
                const randomIndex = Math.floor(Math.random() * wrongOptions.length);
                options.push(wrongOptions[randomIndex]);
                wrongOptions.splice(randomIndex, 1);
            }
            return options.sort(() => Math.random() - 0.5);
        }

        function showWord() {
            if (words.length === 0) {
                document.getElementById("word").textContent = "–°–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç";
                document.getElementById("nextBtn").disabled = true;
                return;
            }
            
            currentWord = getRandomWord();
            if (!currentWord) {
                document.getElementById("word").textContent = "–°–ª–æ–≤–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å";
                document.getElementById("nextBtn").disabled = true;
                return;
            }
            
            document.getElementById("word").textContent = currentWord.en;

            const options = generateOptions(currentWord.ru);
            const optionsContainer = document.getElementById("options");
            optionsContainer.innerHTML = '';

            options.forEach(option => {
                const btn = document.createElement("button");
                btn.textContent = option;
                btn.onclick = () => checkAnswer(option);
                optionsContainer.appendChild(btn);
            });

            document.getElementById("nextBtn").disabled = false;
            document.getElementById("result").textContent = "";
        }

        function checkAnswer(selected) {
            if (!currentWord) return; // –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
            
            const isCorrect = selected === currentWord.ru;
            const resultEl = document.getElementById("result");
            const buttons = document.querySelectorAll("#options button");

            total++;
            if (isCorrect) {
                score++;
                resultEl.textContent = "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                resultEl.style.color = "#a0d8f1";
                buttons.forEach(btn => {
                    if (btn.textContent === selected) btn.classList.add("correct");
                    else btn.disabled = true;
                });
            } else {
                resultEl.textContent = `‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${currentWord.ru}`;
                resultEl.style.color = "#ff8a8a";
                buttons.forEach(btn => {
                    if (btn.textContent === currentWord.ru) btn.classList.add("correct");
                    else if (btn.textContent === selected) btn.classList.add("wrong");
                    btn.disabled = true;
                });
            }

            document.getElementById("score").textContent = `–°—á—ë—Ç: ${score} / ${total}`;
        }

        document.getElementById("nextBtn").addEventListener("click", showWord);
        document.getElementById("exportBtn").addEventListener("click", () => {
            const text = `–¢—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã Den\n\n–í—Å–µ–≥–æ —Å–ª–æ–≤: ${total}\n–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${score}\n–û—à–∏–±–æ–∫: ${total - score}\n–£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${Math.round((score / total) * 100)}%\n\n–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'english-trainer-results.txt';
            a.click();
            URL.revokeObjectURL(url);
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ–≤–∞—Ä—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadWords();
    </script>

</body>
</html>